define("wap/components/wx_image_preview",[],function(){function e(e){var n=e.attr("data-src")||e.attr("src"),t=n.replace(/!.*?\.jpg/i,"!640x320.jpg");return t}function n(e){var n,t,a=2;for(t=0;a>t;t++)if(e=e.parent(),n=e.attr("href"),n&&/[http|https|tel|mailto]:/i.test(n))return!0;return!1}function t(){var n=e($(this));o(n,[n])}var a=[],o=function(e,n){window.WeixinJSBridge&&window.WeixinJSBridge.invoke("imagePreview",{current:e,urls:n})},i={init:function(){var i=$(".js-view-image"),s=0;i.each(function(){var t=$(this),i=e(t);n(t)||t.width()>=s&&i&&(a.push(i),t.on("click",function(){o(i,a)}))}),$(".js-view-image-list").each(function(t){var a=$(this);a.on("click",".js-view-image-item",function(t){var i=a.find(".js-view-image-item");if(!n($(t.target))){i=i.map(function(){var n=$(this);return e(n)}).toArray();var s=e($(this));o(s,i)}})}),$(document.body).off("click",".js-view-single-image",t).on("click",".js-view-single-image",t)},clear:function(){a=[]}};return window.imagePreview=i,i}),function(){function e(){clearTimeout(o),n.addClass("done")}var n=$(".js-tpl-weixin-list-item"),t=$(".js-tpl-weixin-bg");if(!(t.length<=0)){var a=t[0],o=setTimeout(function(){e()},2e3);a.onload=a.onerror=a.onabort=e,a.complete&&e()}}(),function(){var e=$(".js-tpl-shop"),n="/v2/showcase/homepage/goodscount.json";e.length&&$.ajax({url:n,type:"GET",dataType:"json",data:{kdt_id:window._global.kdt_id}}).done(function(n){if(0===+n.code){var t=e.find(".js-all-goods"),a=e.find(".js-new-goods"),o=e.find(".js-order"),i=n.data,s="";s=(i.all_goods.count+"").length,t.find("a").attr("href",i.all_goods.url),t.find(".count").html(i.all_goods.count).addClass("l-"+s),s=(i.new_goods.count+"").length,a.find("a").attr("href",i.new_goods.url),a.find(".count").html(i.new_goods.count).addClass("l-"+s),o.find("a").attr("href",i.order.url)}})}(),function(){$(".js-select-coupon").on("click",function(){var e=$(this),n=window.motify;$.ajax({url:"/v2/ump/promocard/fetchalias.json",type:"POST",data:{kdt_id:e.data("kdt-id"),id:e.data("id")}}).done(function(e){0===+e.code?window.location.href=e.data.url:n.log(e.msg||"网络错误")}).fail(function(){n.log("网络错误")})})}(),window.init_custom_notice=function(e){var n=$(".js-scroll-notice",$(e||"body"));n.length&&n.each(function(){function e(){i--,0>i+a&&(i=o),n.css({left:i})}var n=$(this),t=n.parents(".custom-notice-inner"),a=n.width(),o=t.width(),i=0;o>=a||(n.css({position:"relative"}),setInterval(e,25))})},window.init_custom_notice(),define("wap/showcase/homepage/homepage",function(){}),function(){var e=$(".js-custom-level"),n=$(".js-custom-point"),t=$(".js-custom-level-title-section");if(!(+_global.fans_id<=0&&+_global.buyer_id<=0)){var a=window._global.url.wap+"/showcase/component/point.jsonp?"+$.param({kdt_id:window._global.kdt_id});(e.length>0||n.length>0)&&$.ajax({dataType:"jsonp",type:"GET",url:a,success:function(a){0===+a.code&&(e.html(a.data.level||"会员"),n.html(a.data.point||"暂无数据"),t.removeClass("hide"))}})}}(),define("wap/uc/title",function(){}),define("wap/showcase/base/batch",[],function(){function e(e){e=e||{};var n=e.key,c=e.url,r=e.type||"GET",d=e.para||{},l=e.handler||s;n&&c&&(o[n]||(o[n]={url:c,param:$.extend({},d),type:r},a[n]=[]),i&&(i=!1,t()),a[n].push(l))}function n(){if($.isEmptyObject(o))return void(i=!0);var e=$.extend({},o);o={},$.ajax({url:"/v2/batch",type:"post",dataType:"json",data:{query:e},success:function(e){var n=e.code,t=e.data||{};0==n&&$.each(t,function(e,n){var o=a[e]||[],i=null;try{i=JSON.parse(t[e])}catch(s){i={}}$.each(o,function(n,t){t(i,e)})})},error:function(e,n){},complete:function(){t()}})}function t(){setTimeout(n,1e3)}var a={},o={},i=!1,s=function(){};/loaded|interactive|complete/.test(document.readyState)?setTimeout(n,500):window.addEventListener("load",function(){setTimeout(n,500)}),window.queryBatch=window.queryBatch||e}),function(){function e(){return(new Date).getTime()}function n(e,n){var t=document.createElement("link");t.rel="stylesheet",a(t,n,e),t.async=!0,t.href=e,r.appendChild(t)}function t(e,n){var t=document.createElement("script");t.charset="utf-8",a(t,n,e),t.async=!0,t.src=e,currentlyAddingScript=t,r.appendChild(t),currentlyAddingScript=null}function a(e,n,t){function a(t){e.onload=e.onerror=e.onreadystatechange=null,e=null,n(t)}var o="onload"in e;o?(e.onload=a,e.onerror=function(){a(!0)}):e.onreadystatechange=function(){/loaded|complete/.test(e.readyState)&&a()}}window.zenjs=window.zenjs||{};var o,i={},s=/\.css/,c=function(){},r=document.head||document.getElementsByTagName("head")[0]||document.documentElement,d=function(e,a){function o(n){var t=i[e].items,o=t.indexOf(a);o>-1&&t.splice(o,1),0===t.length&&i[e].callback(n)}a.match(s)?n(a,o):t(a,o)};return o={load:function(){var n=function(e,n){for(var t=0,a=n.length;a>t;t++)d(e,n[t])};return function(t,a){var o=e();i[o]={items:t,callback:function(e){(a||c)(e)}},/loaded|interactive|complete/.test(document.readyState)?n(o,t):window.addEventListener("load",function(){n(o,t)})}}()},window.zenjs.loader=o}(),define("wap/components/loader",function(){}),define("wap/showcase/shop_nav/main",["vendor/zepto/outer","wap/showcase/base/batch","wap/components/loader"],function(e,n,t){var a=$("#shop-nav");if(a.length&&window._global.showcase_type){a.hide();var o=$(),i=o.find(".js-nav-pop"),s=function(e){var n=$(e.target),t=n.parents(".nav-item"),a=n.hasClass(".js-mainmenu")?n:t.find(".js-mainmenu"),o=t.find(".js-submenu"),i=o.find(".arrow"),s=n.parents(".js-navmenu"),c=s.find(".nav-item");o.css("opacity","0").toggle();var r=c.length,d=c.index(t),l=a.outerWidth(),u=(o.outerWidth()-a.outerWidth())/2,h=o.outerWidth()/2;if(0===o.size())$(".js-submenu:visible").hide();else{var f=o.outerWidth(),p=t.outerWidth(),m="auto",v="auto",w="auto",g="auto";0===d?(m=a.position().left-u,v=h-i.outerWidth()/2):d===r-1&&f>p?(w=8,g=l/2-w):(m=a.position().left-u,v=h-i.outerWidth()/2);var y=5;0>m&&(v=v+m+y,m=y),0>w&&(g=g+w+y,w=y),o.css({left:m,right:w}),i.css({left:v,right:g}),$(".js-submenu:visible").not(o).hide(),o.css("opacity","1")}};$(document).on("click",function(e){o[0]&&(e.target==o[0]||$.contains(o[0],e.target)||($(".js-submenu:visible").hide(0),o.hasClass("nav-show")&&(o.removeClass("nav-show").addClass("nav-hide"),setTimeout(function(){i.hide(0)},500))))}),$("body").on("click",".js-navmenu",function(e){var n=$(e.target);e.fromMenu=!0,window.Logger&&Logger.log({fm:"click",title:n.prop("title")||n.text()})}),$("body").on("click",".js-submenu",function(e){var n=$(e.target);e.fromMenu=!0,window.Logger&&Logger.log({fm:"click",title:n.prop("title")||n.text()}),e.stopPropagation()}),$("body").on("click",".js-mainmenu",function(e){s(e)});var c;$(window).on("scroll",function(e){e.preventDefault(),o[0]&&o.hasClass("nav-show")&&(o.removeClass("nav-show").addClass("nav-hide"),setTimeout(function(){i.hide(0)},500))}),$("body").on("click",".js-nav-special",function(e){$(e.target);o[0]&&"animation"!=o.data("animation")&&(o.data("animation","animation"),o.hasClass("nav-show")?(o.removeClass("nav-show").addClass("nav-hide"),c=setTimeout(function(){i.css("display","none"),o.data("animation","")},600)):(i.css("display","block"),o.addClass("nav-show").removeClass("nav-hide"),setTimeout(function(){o.data("animation","")},600)))}),window.queryBatch&&window.queryBatch({key:"shop_nav",url:"/v2/showcase/shopnav/nav.json?kdt_id="+window._global.kdt_id,para:{showcase_type:window._global.showcase_type,url:window.location.host+window.location.pathname,css:"version_css.stylesheets/wap/pages/showcase/shopnav_custom/shopnav_custom"},handler:function(e){if(0==e.code){var n=e.data||{},t=n.html||"",s=n.css||"";window.zenjs.loader.load([s],function(){a.show()}),a.html(t),o=a.find(".js-navmenu"),i=o.find(".js-nav-pop");var c=o.data("type");4!=c&&$("body").addClass("body-fixed-bottom")}}})}}),window.Zepto&&function(e){e.fn.serializeArray=function(){var n,t,a=[],o=function(e){return e.forEach?e.forEach(o):void a.push({name:n,value:e})};return this[0]&&e.each(this[0].elements,function(a,i){t=i.type,n=i.name,n&&"fieldset"!=i.nodeName.toLowerCase()&&!i.disabled&&"submit"!=t&&"reset"!=t&&"button"!=t&&"file"!=t&&("radio"!=t&&"checkbox"!=t||i.checked)&&o(e(i).val())}),a},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(n){e.push(encodeURIComponent(n.name)+"="+encodeURIComponent(n.value))}),e.join("&")},e.fn.submit=function(n){if(0 in arguments)this.bind("submit",n);else if(this.length){var t=e.Event("submit");this.eq(0).trigger(t),t.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),define("vendor/zepto/form",function(){}),define("wap/showcase/search_bar/main",["vendor/zepto/form"],function(){$.fn.searchBar=function(){var e=$.fn.searchBar.container;return e||(e=$.fn.searchBar.init()),this.each(function(){$(this).on("click",function(){e.removeClass("hide"),e.css("display","block"),e.find(".search-input").focus()})})},$.fn.searchBar.init=function(){var e,n=window.localStorage,t=$('<div class="search-container hide" style="display:none;"></div>'),a=$(['<form class="search-form" action="/v2/search" method="GET">','<input type="search" class="search-input" placeholder="搜索本店所有商品" name="q" value="">','<input type="hidden" name="kdt_id" value="'+window._global.kdt_id+'">','<a class="js-search-cancel search-cancel" href="javascript:;">取消</a>','<span class="search-icon"></span>','<span class="close-icon hide"></span>',"</form>"].join("")),o=$('<div class="history-wrap center"></div>'),i=a.find(".js-search-cancel"),s=$('<ul class="history-list"></ul>'),c=$('<a class="tag tag-clear c-gray-darker hide" href="javascript:;">清除历史搜索</a>'),r=a.find(".search-input"),d=a.find(".close-icon"),l="";return n&&(e=(JSON.parse(n.getItem("searchhistory"))||{}).result,e&&($.each(e,function(e,n){l+="<li>"+n+"</li>"}),s.append(l),c.removeClass("hide"))),o.append(s).append(c),t.append(a).append(o),$("body").append(t),$.fn.searchBar.container=t,a.on("submit",function(){var t=$.trim(r.val());n&&t&&(e=e||[],e=$.grep(e,function(e){return e!=t}),e.unshift(t),n.setItem("searchhistory",JSON.stringify({result:e})))}).on("input",function(){""!==$.trim(r.val())?(o.addClass("hide"),d.removeClass("hide")):(o.removeClass("hide"),d.addClass("hide"))}),d.on("click",function(){r.val(""),d.addClass("hide")}),i.on("click",function(){t.addClass("hide"),t.css("display","none")}),s.on("click","li",function(e){r.val($(e.currentTarget).text()),a.submit()}),c.on("click",function(){n&&(n.removeItem("searchhistory"),e=null),o.html("")}),t}}),require(["wap/components/wx_image_preview","vendor/zepto/outer","wap/showcase/homepage/homepage","wap/uc/title","wap/showcase/shop_nav/main","wap/showcase/base/batch","wap/showcase/search_bar/main"],function(e){_global.spm&&"h"===_global.spm.logType&&_global.spm.logType2&&onReady&&onReady("Logger",function(){window.Logger&&Logger.log({spm:_global.spm.logType2+_global.spm.logId2,fm:"display"})}),$(".js-search").searchBar(),_global.goods_id||e.init(),$(".js-mp-chihuo").click(function(e){e.preventDefault();var n=$(e.target);window.Logger&&Logger.log({fm:"click",title:"showcase_nav_chihuo"}).done(function(){location.href=n.data("href")})})}),define("main",function(){});